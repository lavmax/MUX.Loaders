/*
---
description: HTML+CSS AJAX animated loaders.

license: MIT

copyright: Copyright (c) 2011 by Max Lavrov (lavmax).

authors: Max Lavrov (lavmax)

requires:
  core/1.3.2: '*'

provides: [MUX.Loader, MUX.Loader.Fb]

...
*/

MUX=window.MUX||{};MUX.Loader=new Class({Implements:Options,options:{display:"block",delay:16,id:"",classes:"",run:false},initialize:function(b){this.setOptions(b);this.elem.addClass("mux-loader "+this.options.classes).setStyle("display","none");this.elem.id=this.options.id;var a=this;this.elem.start=function(){a.start.apply(a)};this.elem.stop=function(){a.stop.apply(a)};this.gcCounter=0;if(this.options.run){this.start()}},toElement:function(){return this.elem},_setBackground:function(c,b){var d=";";if(typeof b==="string"){d+="background:"+b+";"}else{if(b instanceof Array){for(var a=0;a<b.length;a++){d+=(/:/.test(b[a])?"":"background:")+b[a]+";"}}}c.style.cssText+=d},__animate:function(){if(this.gcCounter>=500&&(this.elem.getStyle("display")==="hidden"||!this.elem.getParent("body"))){clearInterval(this.intervalId);return}this.gcCounter++;this._animate()},start:function(){var a=this;if(this.intervalId){clearInterval(this.intervalId)}this.elem.setStyle("display",this.options.display);this.intervalId=setInterval(function(){a.__animate.apply(a)},this.options.delay)},stop:function(){this.elem.setStyle("display","none");clearInterval(this.intervalId);this.intervalId=undefined}});MUX.Loader.Fb=new Class({Extends:MUX.Loader,options:{height:11,delay:110,background:"#8C9EC3",borderColor:"#526FA7"},initialize:function(a){this.setOptions(a);this.cellHeight=(typeof this.options.height==="string")?this.options.height.toInt():this.options.height;this.cellWidth=Math.floor(this.cellHeight*4/11);this.borderWidth=Math.floor(this.cellWidth/4);this.cellSpacing=this.cellWidth-this.borderWidth;this.cellMargin=Math.floor(this.cellWidth/2);var c=new Element("tr").inject(new Element("tbody").inject(new Element("table",{border:0,cellspacing:0}).inject(this.elem=new Element("div",{styles:{height:this.cellHeight,width:this.cellWidth*3+this.cellMargin*2}}))));this.cells=[];for(var b=0;b<5;b++){if(b%2){new Element("td",{width:this.cellSpacing}).inject(c)}else{this.cells.push(new Element("div",{styles:{margin:this.cellMargin+"px 0px",width:this.cellWidth-this.borderWidth*2,height:this.cellHeight-this.cellMargin*2-this.borderWidth*2,background:this.options.background,border:this.borderWidth+"px solid "+this.options.borderColor,visibility:"hidden",opacity:0}}));new Element("td").grab(this.cells[this.cells.length-1]).inject(c)}}this.step=0;this.steps=6;this.parent(this.options)},_animate:function(){if(this.step<=this.cells.length-1){this.cells[this.step].setStyles({visibility:"visible",opacity:1,margin:"0px",height:this.cellHeight-this.borderWidth*2})}if(this.step-1>=0&&this.step-1<=this.cells.length-1){this.cells[this.step-1].setStyles({visibility:"visible",opacity:0.5,margin:this.cellMargin+"px 0px",height:this.cellHeight-this.cellMargin*2-this.borderWidth*2})}if(this.step-2>=0&&this.step-2<=this.cells.length-1){this.cells[this.step-2].setStyles({visibility:"visible",opacity:0.1,margin:this.cellMargin+"px 0px",height:this.cellHeight-this.cellMargin*2-this.borderWidth*2})}if(this.step-3>=0&&this.step-3<=this.cells.length-1){this.cells[this.step-3].setStyles({visibility:"hidden",opacity:0,margin:this.cellMargin+"px 0px",height:this.cellHeight-this.cellMargin*2-this.borderWidth*2})}if(this.step===this.steps){this.step=0}else{this.step++}}});