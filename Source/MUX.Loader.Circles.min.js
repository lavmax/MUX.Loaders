/*
---
description: HTML+CSS AJAX animated loaders.

license: MIT

copyright: Copyright (c) 2011 by Max Lavrov (lavmax).

authors: Max Lavrov (lavmax)

requires:
  core/1.3.2: '*'

provides: [MUX.Loader, MUX.Loader.Cicles]

...
*/

MUX=window.MUX||{};MUX.Loader=new Class({Implements:Options,options:{display:"block",delay:16,id:"",classes:"",run:false},initialize:function(b){this.setOptions(b);this.elem.addClass("mux-loader "+this.options.classes).setStyle("display","none");this.elem.id=this.options.id;var a=this;this.elem.start=function(){a.start.apply(a)};this.elem.stop=function(){a.stop.apply(a)};this.gcCounter=0;if(this.options.run){this.start()}},toElement:function(){return this.elem},_setBackground:function(c,b){var d=";";if(typeof b==="string"){d+="background:"+b+";"}else{if(b instanceof Array){for(var a=0;a<b.length;a++){d+=(/:/.test(b[a])?"":"background:")+b[a]+";"}}}c.style.cssText+=d},__animate:function(){if(this.gcCounter>=500&&(this.elem.getStyle("display")==="hidden"||!this.elem.getParent("body"))){clearInterval(this.intervalId);return}this.gcCounter++;this._animate()},start:function(){var a=this;if(this.intervalId){clearInterval(this.intervalId)}this.elem.setStyle("display",this.options.display);this.intervalId=setInterval(function(){a.__animate.apply(a)},this.options.delay)},stop:function(){this.elem.setStyle("display","none");clearInterval(this.intervalId);this.intervalId=undefined}});MUX.Loader.Circles=new Class({Extends:MUX.Loader,options:{mode:"out",size:16,delay:50,background:["#7db9e8","-moz-linear-gradient(top, #7db9e8 0%, #1E5799 59%)","-webkit-gradient(linear, left top, left bottom, color-stop(0%,#7db9e8), color-stop(59%,#1E5799))",'filter: progid:DXImageTransform.Microsoft.gradient( startColorstr="#7db9e8", endColorstr="#1E5799",GradientType=0 )',"-o-linear-gradient(top, #7db9e8 0%,#1E5799 59%)"],color:"#fff"},initialize:function(c){this.setOptions(c);this.options.size=(typeof this.options.size==="string")?this.options.size.toInt():this.options.size;var e=(Browser.ie||(Browser.Platform.ios&&Browser.safari&&Browser.version<5));this.elem=new Element("div",{styles:{height:this.options.size,width:this.options.size,position:"relative",overflow:"hidden","border-radius":e?0:(this.options.size.toInt()/2)+"px","-webkit-border-radius":e?0:(this.options.size.toInt()/2)+"px","-moz-border-radius":(this.options.size.toInt()/2)+"px"}});if(this.options.size<30){this.borderWidth=2}else{this.borderWidth=4}if(this.options.mode==="in"||this.options.mode==="post"){this.initShift=this.options.size+this.borderWidth*2;this.step=-2;this.controlPoint=this.options.size%2}else{this.initShift=this.options.size%2;this.step=2;this.controlPoint=this.options.size+this.borderWidth*2}this.shift=this.initShift;var a=Math.floor((this.options.size-this.shift)/2);this.mainRunner=new Element("div",{styles:{position:"absolute",width:this.shift,height:this.shift,top:a,left:a,background:this.options.color,"border-radius":e?0:(this.options.size.toInt()/2)+"px","-webkit-border-radius":e?0:(this.options.size.toInt()/2)+"px","-moz-border-radius":(this.options.size.toInt()/2)+"px"}}).inject(this.elem);this.innerRunner=this.mainRunner.clone().inject(this.elem);var d=Math.max(this.shift-this.borderWidth*2,0);var b=Math.floor((this.options.size-d)/2);this.innerRunner.setStyles({width:d,height:d,top:b,left:b});this._setBackground(this.elem,this.options.background);this._setBackground(this.innerRunner,this.options.background);this.parent(this.options)},_animate:function(){this.shift=this.shift+this.step;var b=Math.floor((this.options.size-this.shift)/2);this.mainRunner.setStyles({width:this.shift,height:this.shift,top:b,left:b});var c=Math.max(this.shift-this.borderWidth*2,0);var a=Math.floor((this.options.size-c)/2);this.innerRunner.setStyles({width:c,height:c,top:a,left:a});if(this.shift===this.controlPoint){this.shift=this.initShift}}});